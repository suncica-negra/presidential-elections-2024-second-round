function getRandomColor(){let e="#";for(let t=0;t<6;t++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e}function hexToRgba(e){let t;if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(e))return t=e.substring(1).split(""),3==t.length&&(t=[t[0],t[0],t[1],t[1],t[2],t[2]]),t=`0x${t.join("")}`,`rgba(${[t>>16&255,t>>8&255,255&t].join(",")},0.1)`;console.error(`[Elections Widget] It was not possible to create an rgba color because the hex color '${e}' is not valid`)}function placeDataInHtml(e){if(!e||!e.lista)return void console.error(`[Elections Widget] The 'lista' key within the results is '${e?.lista}' so it is not possible to display the results`);document.getElementById("election_results").replaceChildren();const t=document.getElementById("person_data_template");if(!t)return;const o=new DocumentFragment;e.lista.slice(0,2).forEach((e=>{const n=t.content.cloneNode(!0),r=n.querySelector(".percent"),l=e.posto;r&&l&&(r.innerText=`${l}%`);const s=e.color||getRandomColor();let a=n.querySelector(".graph.mobile"),c=n.querySelector(".graph.mobile span"),i=234,u=Number((l||"0").replace(/,/g,"."))/100*i;window.innerWidth<900?c&&(c.style.height=`${u}px`):(a=n.querySelector(".graph.desk"),c=n.querySelector(".graph.desk span"),i=260,u=Number((l||"0").replace(/,/g,"."))/100*i,c&&(c.style.width=`${u}px`));const d=hexToRgba(s);a&&(a.style.backgroundColor=d),c&&(c.style.backgroundColor=s);const m=n.querySelector("img"),g=e.naziv;m&&(m.style.backgroundColor=d,m.alt=g,e.image&&(m.style.backgroundImage="url()",m.src=e.image));const y=n.querySelector(".name");y&&(y.innerText=g);const p=n.querySelector(".votes");p&&e.glasova&&(p.innerText=`Broj glasova: ${Number(e.glasova).toLocaleString("hr-HR")}`),o.appendChild(n)}));document.getElementById("election_results").appendChild(o)}function setCss(){const e=new URLSearchParams(window.location.search).get("portal")?.toLowerCase();"24sata"===e?(document.documentElement.style.setProperty("--fontDefault","var(--font24sata)"),document.documentElement.style.setProperty("--fontTitleDefault","var(--fontTitle24sata)"),document.documentElement.style.setProperty("--titleFontWeightDefault","var(--titleFontWeight24sata)"),document.documentElement.style.setProperty("--backgroundDefault","var(--background24sata)"),document.documentElement.style.setProperty("--titleFontSizeDefault","var(--titleFontSize24sata)"),document.documentElement.style.setProperty("--fontPercentDefault","var(--fontPercent24sata)"),document.documentElement.style.setProperty("--percentFontWeightDefault","var(--percentFontWeight24sata)")):"vl"===e?(document.documentElement.style.setProperty("--fontDefault","var(--fontVL)"),document.documentElement.style.setProperty("--fontTitleDefault","var(--fontTitleVL)"),document.documentElement.style.setProperty("--titleFontWeightDefault","var(--titleFontWeightVL)"),document.documentElement.style.setProperty("--backgroundDefault","var(--backgroundVL)"),document.documentElement.style.setProperty("--titleFontSizeDefault","var(--titleFontSizeVL)"),document.documentElement.style.setProperty("--fontPercentDefault","var(--fontPercentVL)"),document.documentElement.style.setProperty("--percentFontWeightDefault","var(--percentFontWeightVL)")):console.error(`[Elections Widget] The font and color are not adjusted because the portal '${e}' is not recognized`)}function setLiveOrNot(e){const t=document.querySelector(".live");t&&e&&(t.style.display="flex")}function autoRefresh(){getElectionsData(!0)}function setProcessedVotesAndLastChange(e,t){const o=document.querySelector(".live_blob");if(!o)return;const n=o.querySelector("#last_change");n&&(n.innerText=`Stanje u ${e}`);const r=o.querySelector("#processed_votes span");r&&(r.innerText=`${t}%`)}async function getElectionsData(e=!1){url="https://showcase.24sata.hr/izbori2024/presidential-elections-2024.json",fetch(url).then((e=>{if(e.ok)return e.json()})).then((t=>{if(t.live=!0,setLiveOrNot(t.live),setProcessedVotesAndLastChange(t.vrijeme,t.bmObradjenoPosto),placeDataInHtml(t),t.live&&!e){const e=t.interval||6e4;setInterval(autoRefresh,e)}})).catch((e=>{console.error(`[Elections widget] Election results data were not retrieved due to: \n${e}`)}))}function debounce(e,t){let o=null;return function(){const n=this,r=arguments;clearTimeout(o),o=setTimeout((()=>{e.apply(n,r)}),t)}}document.addEventListener("DOMContentLoaded",(()=>{setCss(),getElectionsData()})),window.isMob=window.innerWidth<900,window.addEventListener("resize",debounce((()=>{window.innerWidth<900!==window.isMob&&window.location.reload()}),200));
